<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/css/reset.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.css">
    <script src="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.js"></script>
  </head>
  <body class="mixpanel-platform-body">
  <script id='query_one'>
    function main() {
      return People()
      .filter(function(user) { return user.properties['Company Name'] && user.properties['Company Group'] && user.properties['Company Status'] == 'active'; })
      .groupBy(['properties.Company Name', 'properties.Company Group'], mixpanel.reducer.count());
    }
  </script>
  <script id='query_two'>
    function main() {
      var events = ["Comment", "Like", "Donation", "Product Purchase - Step3", "Volunteer Experience Share", "Campaign Social Share", "Volunteer Experience View"];
      return join(
        Events({
          from_date: "2016-03-27",
          to_date: "2016-04-25",
        }),
        People()
      ).filter(function(tuple) {
        if(tuple.user !== undefined && tuple.user.properties['Company Status'] == 'active') {
          if(tuple.event !== undefined && events.indexOf(tuple.event.name) > -1) {
            return tuple;
          }
        }
      })
      .groupBy(['user.properties.Company Name', 'user.properties.Company Group'], mixpanel.reducer.count());
    }
  </script>
  Date: <br>
  <div id="dateSelect"></div>
  <div id="table" style='width:943px'></div><br>
  <script>
  var script_one = document.getElementById('query_one').innerHTML;
  var script_two = document.getElementById('query_two').innerHTML;
  var dateSelect = $('#dateSelect').MPDatepicker();
  var eventTable = $('#table').MPTable({showPercentages: false, firstColHeader: 'Frequency'});
  function runQuery() {
    var params = {
      'from_date': dateSelect.MPDatepicker('value').from.toISOString().slice(0, -14),
      'to_date': dateSelect.MPDatepicker('value').to.toISOString().slice(0, -14),
    };
    MP.api.jql(script_one, params).done(function(results) {
      MP.api.jql(script_two, {}).done(function(moreResults) {
        console.log(results);
        var res = {};
        _.each(results, function(item)) {
          // add combos and uniques
        }
        _.each(moreResults, function(item)) {
          // add events
        }
        eventTable.MPTable('setData', final);
      });
    });
  }
  dateSelect.on('change', function() {runQuery();});
  runQuery();
  </script>
  </body>
</html>